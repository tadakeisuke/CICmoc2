<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>EMOTERRAIN - å¾³å³¶å¸‚æ„Ÿæƒ…ãƒãƒƒãƒ—ï¼ˆé˜¿æ³¢è¸Šã‚Šæ¼”èˆå ´ã‚¨ãƒªã‚¢ï¼‰</title>
    <!-- Leaflet CSS -->
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" crossorigin=""/>
    <!-- Font Awesome -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        :root {
            --cyber-cyan: #06b6d4;
            --cyber-blue: #3b82f6;
            --cyber-purple: #8b5cf6;
            --sidebar-bg: rgba(26,26,46,0.95);
            --panel-bg: rgba(26,26,46,0.95);
            --border-cyan: rgba(6,182,212,0.3);
            --font-mono: 'Monaco', 'Menlo', 'Ubuntu Mono', monospace;
        }
        * { box-sizing: border-box; }
        body {
            margin: 0;
            font-family: var(--font-mono);
            background: linear-gradient(135deg, #1a1a2e, #16213e, #0f3460);
            color: #fff;
            min-height: 100vh;
            overflow: hidden;
        }
        .container {
            display: flex;
            height: 100vh;
            width: 100vw;
        }
        .sidebar {
            width: 320px;
            background: var(--sidebar-bg);
            border-right: 1px solid var(--border-cyan);
            padding: 20px;
            overflow-y: auto;
            z-index: 1000;
            display: flex;
            flex-direction: column;
            gap: 24px;
        }
        .header {
            border-bottom: 1px solid var(--border-cyan);
            padding-bottom: 15px;
            margin-bottom: 10px;
        }
        .logo {
            display: flex;
            align-items: center;
            gap: 10px;
            margin-bottom: 8px;
        }
        .logo-icon {
            width: 32px; height: 32px;
            background: linear-gradient(135deg, var(--cyber-cyan), var(--cyber-blue));
            border-radius: 8px;
            display: flex; align-items: center; justify-content: center;
            color: #fff; font-weight: bold; font-size: 20px;
        }
        .logo-text {
            font-size: 18px; font-weight: bold;
            background: linear-gradient(135deg, var(--cyber-cyan), var(--cyber-blue), var(--cyber-purple));
            -webkit-background-clip: text;
            background-clip: text;
            -webkit-text-fill-color: transparent;
        }
        .subtitle { font-size: 12px; color: var(--cyber-cyan); }
        .timestamp { font-size: 11px; color: #9ca3af; }
        .section-title {
            font-size: 14px; font-weight: bold; color: var(--cyber-cyan);
            margin-bottom: 10px; display: flex; align-items: center; gap: 8px;
        }
        .emotion-filters { display: flex; flex-direction: column; gap: 8px; }
        .emotion-btn {
            padding: 10px 12px;
            border: 1px solid var(--border-cyan);
            background: rgba(55,65,81,0.5);
            color: var(--cyber-cyan);
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.2s;
            display: flex; align-items: center; gap: 10px;
            font-size: 12px; font-weight: bold;
        }
        .emotion-btn:hover { background: rgba(75,85,99,0.5); border-color: rgba(6,182,212,0.5);}
        .emotion-btn.active {
            background: linear-gradient(135deg, var(--cyber-cyan), var(--cyber-blue));
            color: #222; border-color: var(--cyber-cyan);
        }
        .layer-controls, .stats-panel {
            background: rgba(55,65,81,0.5);
            border: 1px solid var(--border-cyan);
            border-radius: 8px;
            padding: 15px;
            margin-bottom: 10px;
        }
        .control-item {
            display: flex; justify-content: space-between; align-items: center;
            margin-bottom: 12px;
        }
        .control-label { font-size: 11px; color: #9ca3af; }
        .toggle-btn {
            padding: 4px 8px;
            border: 1px solid var(--border-cyan);
            background: rgba(75,85,99,0.5);
            color: #9ca3af;
            border-radius: 4px;
            cursor: pointer; font-size: 10px; transition: all 0.2s;
        }
        .toggle-btn.active { background: rgba(6,182,212,0.2); color: var(--cyber-cyan);}
        .opacity-slider {
            width: 100%; height: 4px; background: #374151;
            border-radius: 2px; outline: none; cursor: pointer;
        }
        .stat-item {
            display: flex; justify-content: space-between; align-items: center;
            margin-bottom: 8px; font-size: 11px;
        }
        .stat-label { color: #9ca3af; }
        .stat-value { color: var(--cyber-cyan); font-weight: bold; }
        .emotion-indicator {
            width: 8px; height: 8px; border-radius: 50%; margin-right: 8px; display: inline-block;
        }
        .map-container {
            flex: 1; position: relative;
            min-width: 0;
        }
    
        /* åœ°å›³ç›´æ¥è‰²å¡—ã‚Šç”¨CSS */
        .leaflet-interactive {
            mix-blend-mode: multiply;
        }
    
        .leaflet-overlay-pane svg {
            pointer-events: auto;
        }
    
        /* åœ°å›³ä¸€ä½“åŒ–ç”¨ã®å¢ƒç•Œç·šã‚¹ã‚¿ã‚¤ãƒ« */
        path.leaflet-interactive {
            stroke-linecap: round;
            stroke-linejoin: round;
            vector-effect: non-scaling-stroke;
        }
    
        /* OpenStreetMapã¨ã®å¢ƒç•Œç·šèª¿å’Œ */
        .leaflet-overlay-pane path {
            filter: drop-shadow(0 1px 2px rgba(0,0,0,0.1));
        }
    
        #map { height: 100%; width: 100%; }
        .leaflet-popup-content-wrapper {
            background: var(--panel-bg);
            -webkit-backdrop-filter: blur(20px);
            backdrop-filter: blur(20px);
            border: 1px solid var(--border-cyan);
            border-radius: 8px;
        }
        .leaflet-popup-content {
            color: #fff; font-family: var(--font-mono); margin: 15px;
        }
        .leaflet-popup-tip {
            background: var(--panel-bg);
            border: 1px solid var(--border-cyan);
        }
        .popup-title { font-size: 16px; font-weight: bold; color: var(--cyber-cyan); margin-bottom: 10px;}
        .popup-section { margin-bottom: 12px;}
        .popup-label { font-size: 11px; color: #9ca3af; margin-bottom: 5px;}
        .popup-value { font-size: 12px; color: #fff; font-weight: bold;}
        .emotion-score {
            display: flex; justify-content: space-between; align-items: center;
            margin-bottom: 5px; font-size: 11px;
        }
        .feature-tag {
            display: inline-block;
            background: rgba(6,182,212,0.2);
            color: var(--cyber-cyan);
            padding: 2px 6px; border-radius: 4px; margin-right: 4px;
            font-size: 11px;
        }
        .details-panel {
            width: 340px;
            background: var(--panel-bg);
            border-left: 1px solid var(--border-cyan);
            padding: 20px;
            overflow-y: auto;
            z-index: 1000;
            display: flex; flex-direction: column; gap: 16px;
        }
        .details-title { font-size: 16px; font-weight: bold; color: var(--cyber-cyan); margin-bottom: 10px;}
        .no-selection {
            display: flex; flex-direction: column; align-items: center; justify-content: center;
            height: 100%; color: #9ca3af; gap: 10px;
        }
        .no-selection-icon { font-size: 32px; color: var(--cyber-cyan);}
        .no-selection-text { font-size: 13px;}
        .info-box {
            background: rgba(55,65,81,0.5);
            border: 1px solid var(--border-cyan);
            border-radius: 8px;
            padding: 15px;
            margin-bottom: 10px;
        }
        .info-title { font-size: 13px; font-weight: bold; color: var(--cyber-cyan); margin-bottom: 8px;}
        .info-item { font-size: 12px; margin-bottom: 6px;}
    
        .data-info {
            background: rgba(255,193,7,0.1);
            border: 1px solid rgba(255,193,7,0.3);
            border-radius: 8px;
            padding: 12px;
            margin-bottom: 15px;
            font-size: 11px;
            color: #ffc107;
        }
    
        @media (max-width: 1024px) {
            .sidebar { width: 220px; padding: 10px;}
            .details-panel { width: 220px; padding: 10px;}
        }
        @media (max-width: 768px) {
            .container { flex-direction: column;}
            .sidebar, .details-panel { width: 100vw; min-width: 0; border: none; border-bottom: 1px solid var(--border-cyan);}
            .sidebar { order: 1;}
            .map-container { order: 2; min-height: 300px;}
            .details-panel { order: 3;}
        }
        @media (max-width: 480px) {
            .sidebar, .details-panel { padding: 6px;}
            .header { padding-bottom: 8px;}
            .logo-text { font-size: 15px;}
            .details-title { font-size: 13px;}
        }
    </style>
</head>
<body>
    <div class="container">
        <!-- Left Sidebar -->
        <div class="sidebar">
            <div class="header">
                <div class="logo">
                    <div class="logo-icon">E</div>
                    <div class="logo-text">EMOTERRAIN</div>
                </div>
                <div class="subtitle">å¾³å³¶å¸‚æ„Ÿæƒ…ãƒãƒƒãƒ— - é˜¿æ³¢è¸Šã‚Šã‚¨ãƒªã‚¢</div>
                <div class="timestamp" id="timestamp"></div>
            </div>
      
            <div class="data-info">
                <strong>âš ï¸ GitHub Pageså¯¾å¿œç‰ˆ</strong><br>
                ãƒ­ãƒ¼ã‚«ãƒ«ãƒ•ã‚¡ã‚¤ãƒ«ã‚¢ã‚¯ã‚»ã‚¹åˆ¶é™ã«ã‚ˆã‚Šã€åŸ‹ã‚è¾¼ã¿ãƒ‡ãƒ¼ã‚¿ã‚’ä½¿ç”¨ã—ã¦ã„ã¾ã™ã€‚
                å®Ÿéš›ã®KML/GeoJSONãƒ•ã‚¡ã‚¤ãƒ«ã‚’è¡¨ç¤ºã™ã‚‹ã«ã¯ã€ãƒ­ãƒ¼ã‚«ãƒ«ç’°å¢ƒã§å®Ÿè¡Œã—ã¦ãã ã•ã„ã€‚
            </div>
      
            <div>
                <div class="section-title"><i class="fa-solid fa-info-circle"></i> ãƒ‡ãƒ¼ã‚¿ä»•æ§˜</div>
                <div style="font-size:11px; color:#9ca3af; margin-bottom:15px; line-height:1.4;">
                    æœ¬ã‚·ã‚¹ãƒ†ãƒ ã¯æ”¿åºœçµ±è¨ˆãƒ‡ãƒ¼ã‚¿ï¼ˆå›½åœŸæ•°å€¤æƒ…å ±ï¼‰ã«åŸºã¥ãã€é˜¿æ³¢è¸Šã‚Šæ¼”èˆå ´å‘¨è¾º8ç”ºåŸŸã®æ„Ÿæƒ…åˆ†æã‚’å¯è¦–åŒ–ã—ã¾ã™ã€‚
                    ãƒ‡ãƒ¼ã‚¿ã¯å®‰å…¨ãƒ»çµ±è¨ˆãƒ»ç¤¾ä¼šçš„è¦å› ã‚’ç·åˆçš„ã«åˆ†æã—ã¦ã„ã¾ã™ã€‚
                </div>
            </div>
            <div>
                <div class="section-title"><i class="fa-solid fa-filter"></i> æ„Ÿæƒ…ãƒ•ã‚£ãƒ«ã‚¿ãƒ¼</div>
                <div class="emotion-filters" id="emotion-filters"></div>
            </div>
            <div class="layer-controls">
                <div class="control-item">
                    <span class="control-label">è¡¨ç¤ºãƒ¢ãƒ¼ãƒ‰</span>
                    <select id="display-mode" style="background:#374151; color:#9ca3af; border:1px solid var(--border-cyan); padding:2px 6px; border-radius:4px; font-size:10px;">
                        <option value="boundary">å¢ƒç•Œç·š</option>
                        <option value="heatmap">ãƒ’ãƒ¼ãƒˆãƒãƒƒãƒ—</option>
                    </select>
                </div>
                <div class="control-item">
                    <span class="control-label">æ„Ÿæƒ…ãƒ¬ã‚¤ãƒ¤ãƒ¼</span>
                    <button class="toggle-btn active" id="layer-toggle">ON</button>
                </div>
                <div class="control-item">
                    <span class="control-label">ãƒ©ãƒ™ãƒ«è¡¨ç¤º</span>
                    <button class="toggle-btn active" id="label-toggle">ON</button>
                </div>
                <div class="control-item">
                    <span class="control-label">é€æ˜åº¦</span>
                    <span class="stat-value">70%</span>
                </div>
                <input type="range" min="0.2" max="1" step="0.01" value="0.7" class="opacity-slider" id="opacity-slider" title="é€æ˜åº¦èª¿æ•´">
            </div>
            <div class="stats-panel" id="stats-panel"></div>
        </div>
    
        <!-- Map Container -->
        <div class="map-container">
            <div id="map"></div>
            <div style="position:absolute;bottom:8px;right:12px;z-index:999;font-size:11px;background:rgba(26,26,46,0.7);padding:4px 10px;border-radius:6px;">
                Â© <a href="https://openstreetmap.org" target="_blank" rel="noopener" style="color:#06b6d4;text-decoration:underline;">OpenStreetMap</a> contributors
            </div>
        </div>
    
        <!-- Right Details Panel -->
        <div class="details-panel" id="details-panel"></div>
    </div>
  
    <!-- Leaflet JS -->
    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js" crossorigin=""></script>
    <script>
        // æ„Ÿæƒ…ã‚«ãƒ©ãƒ¼ï¼ˆå¼·åº¦åˆ¥ï¼‰
        const emotionColors = {
            joy: {
                low: (opacity) => `rgba(34,197,94,${opacity * 0.4})`,
                medium: (opacity) => `rgba(34,197,94,${opacity * 0.7})`,
                high: (opacity) => `rgba(34,197,94,${opacity})`,
                veryHigh: (opacity) => `rgba(21,128,61,${opacity})`
            },
            calm: {
                low: (opacity) => `rgba(59,130,246,${opacity * 0.4})`,
                medium: (opacity) => `rgba(59,130,246,${opacity * 0.7})`,
                high: (opacity) => `rgba(59,130,246,${opacity})`,
                veryHigh: (opacity) => `rgba(37,99,235,${opacity})`
            },
            excitement: {
                low: (opacity) => `rgba(251,146,60,${opacity * 0.4})`,
                medium: (opacity) => `rgba(251,146,60,${opacity * 0.7})`,
                high: (opacity) => `rgba(251,146,60,${opacity})`,
                veryHigh: (opacity) => `rgba(217,119,6,${opacity})`
            },
            stress: {
                low: (opacity) => `rgba(248,113,113,${opacity * 0.4})`,
                medium: (opacity) => `rgba(248,113,113,${opacity * 0.7})`,
                high: (opacity) => `rgba(248,113,113,${opacity})`,
                veryHigh: (opacity) => `rgba(220,38,38,${opacity})`
            }
        };

        // GitHub Pageså¯¾å¿œï¼šåŸ‹ã‚è¾¼ã¿GeoJSONãƒ‡ãƒ¼ã‚¿
        const getEmbeddedGeoJSON = () => {
            return {
                "type": "FeatureCollection",
                "features": [
                    {
                        "type": "Feature",
                        "properties": {
                            "name": "ä¸¡å›½æœ¬ç”º",
                            "type": "æ–‡åŒ–ãƒ»è¦³å…‰åœ°åŸŸ",
                            "population": 1200,
                            "area": 0.35,
                            "households": 480,
                            "emotions": { "joy": 78, "calm": 65, "excitement": 85, "stress": 25 },
                            "incidents": { "total": 12, "safety": 8, "traffic": 3, "other": 1 },
                            "analysis": { "primary": "excitement", "intensity": "éå¸¸ã«é«˜", "factors": ["é˜¿æ³¢è¸Šã‚Šä¼šå ´", "æ–‡åŒ–æ–½è¨­", "è¦³å…‰åœ°"] },
                            "features": ["é˜¿æ³¢è¸Šã‚Šæ¼”èˆå ´", "æ–‡åŒ–ã‚»ãƒ³ã‚¿ãƒ¼", "è¦³å…‰æ¡ˆå†…æ‰€", "è¨˜å¿µé¤¨"],
                            "recommendations": ["ç¥­ã‚ŠæœŸé–“ä¸­ã®äº¤é€šæ•´ç†", "è¦³å…‰æ¡ˆå†…å¼·åŒ–", "æ–‡åŒ–ã‚¤ãƒ™ãƒ³ãƒˆæ‹¡å……"]
                        },
                        "geometry": {
                            "type": "Polygon",
                            "coordinates": [[[134.5591, 34.0659], [134.5621, 34.0659], [134.5621, 34.0689], [134.5591, 34.0689], [134.5591, 34.0659]]]
                        }
                    },
                    {
                        "type": "Feature",
                        "properties": {
                            "name": "å¯ºå³¶æœ¬ç”ºè¥¿ï¼‘ä¸ç›®",
                            "type": "ãƒ“ã‚¸ãƒã‚¹ãƒ»ä½å®…åœ°åŸŸ",
                            "population": 950,
                            "area": 0.28,
                            "households": 420,
                            "emotions": { "joy": 58, "calm": 72, "excitement": 45, "stress": 35 },
                            "incidents": { "total": 8, "safety": 5, "traffic": 2, "other": 1 },
                            "analysis": { "primary": "calm", "intensity": "é«˜", "factors": ["ä½å®…åœ°", "ãƒ“ã‚¸ãƒã‚¹è¡—", "äº¤é€šåˆ©ä¾¿æ€§"] },
                            "features": ["ã‚ªãƒ•ã‚£ã‚¹ãƒ“ãƒ«", "ä½å®…", "å°å­¦æ ¡", "å•†åº—è¡—"],
                            "recommendations": ["ä½ç’°å¢ƒæ”¹å–„", "äº¤é€šå®‰å…¨å¯¾ç­–", "åœ°åŸŸã‚³ãƒŸãƒ¥ãƒ‹ãƒ†ã‚£å¼·åŒ–"]
                        },
                        "geometry": {
                            "type": "Polygon",
                            "coordinates": [[[134.5561, 34.0659], [134.5591, 34.0659], [134.5591, 34.0689], [134.5561, 34.0689], [134.5561, 34.0659]]]
                        }
                    },
                    {
                        "type": "Feature",
                        "properties": {
                            "name": "å¯ºå³¶æœ¬ç”ºè¥¿ï¼’ä¸ç›®",
                            "type": "ä½å®…åœ°åŸŸ",
                            "population": 880,
                            "area": 0.32,
                            "households": 380,
                            "emotions": { "joy": 62, "calm": 75, "excitement": 42, "stress": 28 },
                            "incidents": { "total": 6, "safety": 4, "traffic": 1, "other": 1 },
                            "analysis": { "primary": "calm", "intensity": "é«˜", "factors": ["é™ã‹ãªä½å®…åœ°", "å…¬åœ’", "å®‰å…¨æ€§"] },
                            "features": ["ä½å®…", "å…¬åœ’", "ä¿è‚²åœ’", "è¨ºç™‚æ‰€"],
                            "recommendations": ["ç·‘åœ°æ•´å‚™", "å­è‚²ã¦æ”¯æ´", "é«˜é½¢è€…å¯¾ç­–"]
                        },
                        "geometry": {
                            "type": "Polygon",
                            "coordinates": [[[134.5531, 34.0659], [134.5561, 34.0659], [134.5561, 34.0689], [134.5531, 34.0689], [134.5531, 34.0659]]]
                        }
                    },
                    {
                        "type": "Feature",
                        "properties": {
                            "name": "å¯ºå³¶æœ¬ç”ºæ±ï¼‘ä¸ç›®",
                            "type": "å•†æ¥­ãƒ»ä½å®…åœ°åŸŸ",
                            "population": 1050,
                            "area": 0.30,
                            "households": 450,
                            "emotions": { "joy": 68, "calm": 60, "excitement": 65, "stress": 32 },
                            "incidents": { "total": 9, "safety": 6, "traffic": 2, "other": 1 },
                            "analysis": { "primary": "joy", "intensity": "é«˜", "factors": ["å•†æ¥­æ–½è¨­", "æ´»æ°—", "åˆ©ä¾¿æ€§"] },
                            "features": ["å•†æ¥­æ–½è¨­", "ä½å®…", "éŠ€è¡Œ", "éƒµä¾¿å±€"],
                            "recommendations": ["å•†æ¥­æ´»æ€§åŒ–", "äº¤é€šæ•´ç†", "é˜²çŠ¯å¼·åŒ–"]
                        },
                        "geometry": {
                            "type": "Polygon",
                            "coordinates": [[[134.5621, 34.0659], [134.5651, 34.0659], [134.5651, 34.0689], [134.5621, 34.0689], [134.5621, 34.0659]]]
                        }
                    },
                    {
                        "type": "Feature",
                        "properties": {
                            "name": "å¯ºå³¶æœ¬ç”ºæ±ï¼’ä¸ç›®",
                            "type": "ä½å®…ãƒ»å•†æ¥­åœ°åŸŸ",
                            "population": 920,
                            "area": 0.27,
                            "households": 400,
                            "emotions": { "joy": 65, "calm": 68, "excitement": 55, "stress": 30 },
                            "incidents": { "total": 7, "safety": 5, "traffic": 1, "other": 1 },
                            "analysis": { "primary": "calm", "intensity": "é«˜", "factors": ["ãƒãƒ©ãƒ³ã‚¹è‰¯ã„ä½ç’°å¢ƒ", "å•†æ¥­åˆ©ä¾¿æ€§"] },
                            "features": ["ä½å®…", "å°è¦æ¨¡å•†åº—", "å…¬æ°‘é¤¨", "ç¥ç¤¾"],
                            "recommendations": ["åœ°åŸŸæ´»æ€§åŒ–", "ä¼çµ±ä¿å­˜", "ã‚³ãƒŸãƒ¥ãƒ‹ãƒ†ã‚£æ”¯æ´"]
                        },
                        "geometry": {
                            "type": "Polygon",
                            "coordinates": [[[134.5651, 34.0659], [134.5681, 34.0659], [134.5681, 34.0689], [134.5651, 34.0689], [134.5651, 34.0659]]]
                        }
                    },
                    {
                        "type": "Feature",
                        "properties": {
                            "name": "å—å†…ç”ºï¼‘ä¸ç›®",
                            "type": "ä½å®…åœ°åŸŸ",
                            "population": 760,
                            "area": 0.25,
                            "households": 320,
                            "emotions": { "joy": 55, "calm": 80, "excitement": 38, "stress": 22 },
                            "incidents": { "total": 4, "safety": 2, "traffic": 1, "other": 1 },
                            "analysis": { "primary": "calm", "intensity": "éå¸¸ã«é«˜", "factors": ["é™ã‹ãªä½å®…åœ°", "ä½çŠ¯ç½ªç‡", "è‡ªç„¶ç’°å¢ƒ"] },
                            "features": ["ä½å®…", "å°å…¬åœ’", "é›†ä¼šæ‰€", "å¯ºé™¢"],
                            "recommendations": ["ä½ç’°å¢ƒä¿æŒ", "é«˜é½¢è€…æ”¯æ´", "é˜²ç½å¯¾ç­–"]
                        },
                        "geometry": {
                            "type": "Polygon",
                            "coordinates": [[[134.5561, 34.0629], [134.5591, 34.0629], [134.5591, 34.0659], [134.5561, 34.0659], [134.5561, 34.0629]]]
                        }
                    },
                    {
                        "type": "Feature",
                        "properties": {
                            "name": "ä¸€ç•ªç”º",
                            "type": "å•†æ¥­åœ°åŸŸ",
                            "population": 1380,
                            "area": 0.42,
                            "households": 580,
                            "emotions": { "joy": 72, "calm": 55, "excitement": 75, "stress": 38 },
                            "incidents": { "total": 15, "safety": 10, "traffic": 4, "other": 1 },
                            "analysis": { "primary": "excitement", "intensity": "é«˜", "factors": ["å•†æ¥­ä¸­å¿ƒåœ°", "äººæµé›†ä¸­", "æ´»æ°—"] },
                            "features": ["ç™¾è²¨åº—", "å•†åº—è¡—", "ãƒ¬ã‚¹ãƒˆãƒ©ãƒ³", "é§…"],
                            "recommendations": ["äº¤é€šæ¸‹æ»å¯¾ç­–", "å•†æ¥­æ´»æ€§åŒ–", "å®‰å…¨å¯¾ç­–å¼·åŒ–"]
                        },
                        "geometry": {
                            "type": "Polygon",
                            "coordinates": [[[134.5591, 34.0629], [134.5621, 34.0629], [134.5621, 34.0659], [134.5591, 34.0659], [134.5591, 34.0629]]]
                        }
                    },
                    {
                        "type": "Feature",
                        "properties": {
                            "name": "å…«ç™¾å±‹ç”º",
                            "type": "ä¼çµ±å•†æ¥­åœ°åŸŸ",
                            "population": 680,
                            "area": 0.22,
                            "households": 290,
                            "emotions": { "joy": 60, "calm": 65, "excitement": 58, "stress": 28 },
                            "incidents": { "total": 5, "safety": 3, "traffic": 1, "other": 1 },
                            "analysis": { "primary": "calm", "intensity": "é«˜", "factors": ["ä¼çµ±çš„å•†æ¥­", "åœ°åŸŸå¯†ç€", "å®‰å®šæ€§"] },
                            "features": ["ä¼çµ±å•†åº—", "è·äººå·¥æˆ¿", "å¸‚å ´", "ç¥ç¤¾"],
                            "recommendations": ["ä¼çµ±ç”£æ¥­æ”¯æ´", "è¦³å…‰åŒ–æ¨é€²", "å¾Œç¶™è€…è‚²æˆ"]
                        },
                        "geometry": {
                            "type": "Polygon",
                            "coordinates": [[[134.5621, 34.0629], [134.5651, 34.0629], [134.5651, 34.0659], [134.5621, 34.0659], [134.5621, 34.0629]]]
                        }
                    }
                ],
                "metadata": {
                    "source": "GitHub Pages Embedded Data",
                    "description": "å¾³å³¶å¸‚é˜¿æ³¢è¸Šã‚Šæ¼”èˆå ´å‘¨è¾º8ç”ºåŸŸã®æ„Ÿæƒ…åˆ†æãƒ‡ãƒ¼ã‚¿",
                    "created": new Date().toISOString(),
                    "version": "1.0.0-github-pages"
                }
            };
        };

        // ç”ºåŸŸã‚¿ã‚¤ãƒ—åˆ¤å®š
        const getDistrictType = (districtName) => {
            const types = {
                'ä¸¡å›½æœ¬ç”º': 'æ–‡åŒ–ãƒ»è¦³å…‰åœ°åŸŸ',
                'å¯ºå³¶æœ¬ç”ºè¥¿ï¼‘ä¸ç›®': 'ãƒ“ã‚¸ãƒã‚¹ãƒ»ä½å®…åœ°åŸŸ',
                'å¯ºå³¶æœ¬ç”ºè¥¿ï¼’ä¸ç›®': 'ä½å®…åœ°åŸŸ',
                'å¯ºå³¶æœ¬ç”ºæ±ï¼‘ä¸ç›®': 'å•†æ¥­ãƒ»ä½å®…åœ°åŸŸ',
                'å¯ºå³¶æœ¬ç”ºæ±ï¼’ä¸ç›®': 'ä½å®…ãƒ»å•†æ¥­åœ°åŸŸ',
                'å—å†…ç”ºï¼‘ä¸ç›®': 'ä½å®…åœ°åŸŸ',
                'ä¸€ç•ªç”º': 'å•†æ¥­åœ°åŸŸ',
                'å…«ç™¾å±‹ç”º': 'ä¼çµ±å•†æ¥­åœ°åŸŸ'
            };
            return types[districtName] || 'æ··åˆåœ°åŸŸ';
        };

        // ã‚°ãƒ­ãƒ¼ãƒãƒ«å¤‰æ•°
        let map, emotionLayer, selectedEmotion = 'all', selectedArea = null, showEmotionLayer = true, showLabels = true, layerOpacity = 0.7, displayMode = 'boundary';
        let sanoAzaGeoJSON;

        // åœ°å›³åˆæœŸåŒ–ï¼ˆGitHub Pageså¯¾å¿œï¼‰
        function initializeMap() {
            try {
                console.log('ğŸ—ºï¸ GitHub Pageså¯¾å¿œåœ°å›³åˆæœŸåŒ–é–‹å§‹...');
        
                // ãƒ‡ãƒ¼ã‚¿èª­ã¿è¾¼ã¿
                sanoAzaGeoJSON = getEmbeddedGeoJSON();
                console.log('âœ… åŸ‹ã‚è¾¼ã¿GeoJSONãƒ‡ãƒ¼ã‚¿èª­ã¿è¾¼ã¿å®Œäº†:', sanoAzaGeoJSON);
        
                // åœ°å›³ä½œæˆï¼ˆå¾³å³¶å¸‚ä¸­å¿ƒéƒ¨ï¼‰
                map = L.map('map', {
                    preferCanvas: true
                }).setView([34.0658, 134.5591], 15);
        
                // OSMã‚¿ã‚¤ãƒ«ãƒ¬ã‚¤ãƒ¤ãƒ¼è¿½åŠ 
                L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
                    attribution: 'Â© OpenStreetMap contributors',
                    crossOrigin: true
                }).addTo(map);
        
                // æ„Ÿæƒ…ãƒ‡ãƒ¼ã‚¿ãƒ¬ã‚¤ãƒ¤ãƒ¼èª­ã¿è¾¼ã¿
                loadEmotionData();
        
                console.log('âœ… GitHub Pageså¯¾å¿œåœ°å›³åˆæœŸåŒ–å®Œäº†ï¼');
        
            } catch (error) {
                console.error('âŒ åœ°å›³åˆæœŸåŒ–ã‚¨ãƒ©ãƒ¼:', error);
        
                // ã‚¨ãƒ©ãƒ¼æƒ…å ±ã‚’ç”»é¢ã«è¡¨ç¤º
                const mapElement = document.getElementById('map');
                if (mapElement) {
                    mapElement.innerHTML = `
                        <div style="display:flex;align-items:center;justify-content:center;height:100%;flex-direction:column;background:#1a1a2e;color:#fff;">
                            <div style="font-size:48px;color:#f59e0b;margin-bottom:20px;">âš ï¸</div>
                            <h2 style="color:#06b6d4;margin-bottom:15px;">åœ°å›³èª­ã¿è¾¼ã¿ã‚¨ãƒ©ãƒ¼</h2>
                            <p style="color:#9ca3af;text-align:center;max-width:400px;line-height:1.6;">
                                åœ°å›³ã®åˆæœŸåŒ–ã«å¤±æ•—ã—ã¾ã—ãŸã€‚<br>
                                ãƒ–ãƒ©ã‚¦ã‚¶ã‚’æ›´æ–°ã™ã‚‹ã‹ã€ã‚¤ãƒ³ã‚¿ãƒ¼ãƒãƒƒãƒˆæ¥ç¶šã‚’ç¢ºèªã—ã¦ãã ã•ã„ã€‚
                            </p>
                            <pre style="background:#374151;padding:10px;border-radius:4px;font-size:12px;color:#f59e0b;margin-top:15px;overflow:auto;max-width:90%;">
${error.message}
                            </pre>
                        </div>
                    `;
                }
            }
        }

        // æ„Ÿæƒ…ãƒ¬ã‚¤ãƒ¤ãƒ¼æç”»
        function loadEmotionData() {
            try {
                console.log('ğŸ˜Š æ„Ÿæƒ…ãƒ‡ãƒ¼ã‚¿ãƒ¬ã‚¤ãƒ¤ãƒ¼ä½œæˆé–‹å§‹...');
        
                if (!sanoAzaGeoJSON || !sanoAzaGeoJSON.features) {
                    throw new Error('GeoJSONãƒ‡ãƒ¼ã‚¿ãŒå­˜åœ¨ã—ã¾ã›ã‚“');
                }
        
                // æ—¢å­˜ãƒ¬ã‚¤ãƒ¤ãƒ¼å‰Šé™¤
                if (emotionLayer) {
                    map.removeLayer(emotionLayer);
                }
        
                // GeoJSONãƒ¬ã‚¤ãƒ¤ãƒ¼ä½œæˆ
                emotionLayer = L.geoJSON(sanoAzaGeoJSON, {
                    style: getEmotionStyle,
                    onEachFeature: function(feature, layer) {
                        // ãƒãƒƒãƒ—ã‚¢ãƒƒãƒ—è¨­å®š
                        layer.bindPopup(createPopupContent(feature), {
                            maxWidth: 300,
                            className: 'emotion-popup'
                        });
            
                        // ã‚¯ãƒªãƒƒã‚¯ã‚¤ãƒ™ãƒ³ãƒˆ
                        layer.on('click', function() {
                            selectArea(feature);
                        });
            
                        // ãƒ›ãƒãƒ¼ã‚¤ãƒ™ãƒ³ãƒˆ
                        layer.on('mouseover', function(e) {
                            layer.setStyle({
                                weight: 3,
                                fillOpacity: Math.min(layerOpacity + 0.2, 1)
                            });
                        });
            
                        layer.on('mouseout', function(e) {
                            layer.setStyle(getEmotionStyle(feature));
                        });
                    },
                    filter: feature => {
                        if (selectedEmotion === 'all') return true;
                        return feature.properties.analysis.primary === selectedEmotion;
                    }
                });
        
                // ãƒ¬ã‚¤ãƒ¤ãƒ¼ã‚’åœ°å›³ã«è¿½åŠ 
                if (showEmotionLayer) {
                    emotionLayer.addTo(map);
                }
        
                // ãƒ©ãƒ™ãƒ«è¡¨ç¤º
                if (showLabels) {
                    addLabels();
                }
        
                console.log('âœ… æ„Ÿæƒ…ãƒ‡ãƒ¼ã‚¿ãƒ¬ã‚¤ãƒ¤ãƒ¼ä½œæˆå®Œäº†ï¼');
        
            } catch (error) {
                console.error('âŒ æ„Ÿæƒ…ãƒ‡ãƒ¼ã‚¿ãƒ¬ã‚¤ãƒ¤ãƒ¼ä½œæˆã‚¨ãƒ©ãƒ¼:', error);
            }
        }

        // ãƒ©ãƒ™ãƒ«æç”»
        function addLabels() {
            if (!sanoAzaGeoJSON || !sanoAzaGeoJSON.features) return;
      
            sanoAzaGeoJSON.features.forEach(feature => {
                if (feature.geometry && feature.geometry.coordinates) {
                    const coords = feature.geometry.coordinates[0];
                    const center = getPolygonCenter(coords);
          
                    const marker = L.marker([center[1], center[0]], {
                        icon: L.divIcon({
                            className: 'district-label',
                            html: `<div style="background:rgba(26,26,46,0.9);color:#06b6d4;padding:2px 6px;border-radius:4px;font-size:10px;font-weight:bold;border:1px solid rgba(6,182,212,0.3);white-space:nowrap;">${feature.properties.name}</div>`,
                            iconSize: [100, 20],
                            iconAnchor: [50, 10]
                        }),
                        interactive: false
                    });
          
                    if (showLabels) {
                        marker.addTo(map);
                    }
                }
            });
        }

        // ãƒãƒªã‚´ãƒ³ä¸­å¿ƒè¨ˆç®—
        function getPolygonCenter(coords) {
            let x = 0, y = 0, n = coords.length;
            coords.forEach(c => { x += c[0]; y += c[1]; });
            return [x/n, y/n];
        }

        // ãƒãƒªã‚´ãƒ³ã‚¹ã‚¿ã‚¤ãƒ«
        function getEmotionStyle(feature) {
            const emotion = feature.properties.analysis.primary;
            const intensity = feature.properties.analysis.intensity;
      
            let colorLevel;
            switch(intensity) {
                case 'ä½': colorLevel = 'low'; break;
                case 'ä¸­ç¨‹åº¦': 
                case 'ä¸­': colorLevel = 'medium'; break;
                case 'é«˜': colorLevel = 'high'; break;
                case 'éå¸¸ã«é«˜': colorLevel = 'veryHigh'; break;
                default: colorLevel = 'medium';
            }
      
            if (displayMode === 'heatmap') {
                return {
                    fillColor: emotionColors[emotion][colorLevel](1),
                    weight: 1,
                    opacity: 0.8,
                    color: '#ffffff',
                    fillOpacity: layerOpacity,
                    dashArray: null
                };
            } else {
                return {
                    fillColor: emotionColors[emotion][colorLevel](1),
                    weight: 2,
                    opacity: 0.9,
                    color: emotionColors[emotion][colorLevel](1),
                    fillOpacity: layerOpacity * 0.6,
                    dashArray: null
                };
            }
        }

        // ãƒãƒƒãƒ—ã‚¢ãƒƒãƒ—å†…å®¹
        function createPopupContent(feature) {
            const p = feature.properties;
            const primaryEmotion = p.analysis.primary;
      
            return `
                <div class="popup-title">${p.name} <span style="color:#9ca3af;">(${p.type})</span></div>
        
                <div class="popup-section">
                    <div class="popup-label">ä¸»è¦æ„Ÿæƒ…ãƒ»å¼·åº¦</div>
                    <div class="popup-value" style="color:${getEmotionColorForPopup(primaryEmotion, p.emotions[primaryEmotion])}">${capitalize(primaryEmotion)} - ${p.analysis.intensity}</div>
                </div>
        
                <div class="popup-section">
                    <div class="popup-label">æ„Ÿæƒ…ã‚¹ã‚³ã‚¢</div>
                    ${Object.entries(p.emotions).map(([emotion, score]) => `
                        <div class="emotion-score">
                            <span><div class="emotion-indicator" style="background-color:${getEmotionColorForPopup(emotion, score)}"></div>${capitalize(emotion)}</span>
                            <span style="color:${getEmotionColorForPopup(emotion, score)}">${score}</span>
                        </div>
                    `).join('')}
                </div>
        
                <div class="popup-section">
                    <div class="popup-label">åŸºæœ¬æƒ…å ±</div>
                    <div>äººå£: <span class="popup-value">${p.population.toLocaleString()}äºº</span></div>
                    <div>ä¸–å¸¯æ•°: <span class="popup-value">${p.households.toLocaleString()}ä¸–å¸¯</span></div>
                    <div>é¢ç©: <span class="popup-value">${p.area}kmÂ²</span></div>
                </div>
        
                <div class="popup-section">
                    <div class="popup-label">ä¸»è¦æ–½è¨­</div>
                    <div>${p.features.map(f => `<span class="feature-tag">${f}</span>`).join('')}</div>
                </div>
            `;
        }

        function getEmotionColorForPopup(emotion, score) {
            if (score >= 70) return emotionColors[emotion].veryHigh(1);
            if (score >= 60) return emotionColors[emotion].high(1);
            if (score >= 40) return emotionColors[emotion].medium(1);
            return emotionColors[emotion].low(1);
        }

        // è©³ç´°ãƒ‘ãƒãƒ«æ›´æ–°
        function updateDetailsPanel() {
            const panel = document.getElementById('details-panel');
            if (!selectedArea) {
                panel.innerHTML = `
                    <div class="no-selection">
                        <div class="no-selection-icon"><i class="fa-solid fa-map-location-dot"></i></div>
                        <div class="no-selection-text">åœ°å›³ä¸Šã®åŒºç”»ã‚’ã‚¯ãƒªãƒƒã‚¯ã—ã¦<br>è©³ç´°æƒ…å ±ã‚’è¡¨ç¤º</div>
                    </div>
                `;
                return;
            }
      
            const p = selectedArea.properties;
            const primaryEmotion = p.analysis.primary;
      
            panel.innerHTML = `
                <div class="details-title">${p.name}</div>
        
                <div class="info-box">
                    <div class="info-title">åŸºæœ¬æƒ…å ±</div>
                    <div class="info-item">åœ°åŸŸã‚¿ã‚¤ãƒ—: ${p.type}</div>
                    <div class="info-item">äººå£: ${p.population.toLocaleString()}äºº</div>
                    <div class="info-item">ä¸–å¸¯æ•°: ${p.households.toLocaleString()}ä¸–å¸¯</div>
                    <div class="info-item">é¢ç©: ${p.area}kmÂ²</div>
                    <div class="info-item">äººå£å¯†åº¦: ${Math.round(p.population/p.area).toLocaleString()}äºº/kmÂ²</div>
                </div>
        
                <div class="info-box">
                    <div class="info-title">æ„Ÿæƒ…åˆ†æçµæœ</div>
                    <div class="info-item">ä¸»è¦æ„Ÿæƒ…: <span style="color:${getEmotionColorForPopup(primaryEmotion, p.emotions[primaryEmotion])}">${capitalize(primaryEmotion)}</span></div>
                    <div class="info-item">å¼·åº¦ãƒ¬ãƒ™ãƒ«: ${p.analysis.intensity}</div>
                    <div class="info-item">å½±éŸ¿è¦å› : ${p.analysis.factors.join(', ')}</div>
                </div>
        
                <div class="info-box">
                    <div class="info-title">ä¸»è¦æ–½è¨­</div>
                    ${p.features.map(f => `<div class="info-item">â€¢ ${f}</div>`).join('')}
                </div>
        
                <div class="info-box">
                    <div class="info-title">äº‹æ¡ˆãƒ»å®‰å…¨æƒ…å ±</div>
                    <div class="info-item">ç·äº‹æ¡ˆæ•°: ${p.incidents.total}ä»¶</div>
                    <div class="info-item">å®‰å…¨é–¢é€£: ${p.incidents.safety}ä»¶</div>
                    <div class="info-item">äº¤é€šé–¢é€£: ${p.incidents.traffic}ä»¶</div>
                    <div class="info-item">ãã®ä»–: ${p.incidents.other}ä»¶</div>
                </div>
        
                <div class="info-box">
                    <div class="info-title">æ¨å¥¨æ–½ç­–</div>
                    ${p.recommendations.map(r => `<div class="info-item">â€¢ ${r}</div>`).join('')}
                </div>
            `;
        }

        // ã‚¨ãƒªã‚¢é¸æŠ
        function selectArea(feature) {
            selectedArea = feature;
            updateDetailsPanel();
        }

        // çµ±è¨ˆãƒ‘ãƒãƒ«æ›´æ–°
        function updateStatistics() {
            const statsPanel = document.getElementById('stats-panel');
            if (!sanoAzaGeoJSON || !sanoAzaGeoJSON.features) return;
      
            const filtered = sanoAzaGeoJSON.features.filter(f => {
                if (selectedEmotion === 'all') return true;
                return f.properties.analysis.primary === selectedEmotion;
            });
      
            const totalPop = filtered.reduce((sum,f) => sum + f.properties.population, 0);
            const totalArea = filtered.reduce((sum,f) => sum + f.properties.area, 0);
            const totalIncidents = filtered.reduce((sum,f) => sum + f.properties.incidents.total, 0);
            const avgDensity = filtered.length ? Math.round(totalPop / totalArea) : 0;
      
            const avgEmotions = { joy:0, calm:0, excitement:0, stress:0 };
            filtered.forEach(f => {
                Object.keys(avgEmotions).forEach(k => {
                    avgEmotions[k] += f.properties.emotions[k];
                });
            });
            Object.keys(avgEmotions).forEach(k => {
                avgEmotions[k] = filtered.length ? Math.round(avgEmotions[k]/filtered.length) : 0;
            });
      
            const intensityCount = { 'ä½': 0, 'ä¸­ç¨‹åº¦': 0, 'é«˜': 0, 'éå¸¸ã«é«˜': 0 };
            filtered.forEach(f => {
                const intensity = f.properties.analysis.intensity;
                if (intensityCount[intensity] !== undefined) {
                    intensityCount[intensity]++;
                }
            });
      
            statsPanel.innerHTML = `
                <div class="section-title"><i class="fa-solid fa-chart-pie"></i> çµ±è¨ˆæƒ…å ±</div>
        
                <div class="stat-item"><span class="stat-label">åŒºç”»æ•°</span><span class="stat-value">${filtered.length}</span></div>
                <div class="stat-item"><span class="stat-label">ç·äººå£</span><span class="stat-value">${totalPop.toLocaleString()}äºº</span></div>
                <div class="stat-item"><span class="stat-label">ç·é¢ç©</span><span class="stat-value">${totalArea}kmÂ²</span></div>
                <div class="stat-item"><span class="stat-label">å¹³å‡å¯†åº¦</span><span class="stat-value">${avgDensity.toLocaleString()}äºº/kmÂ²</span></div>
                <div class="stat-item"><span class="stat-label">ç·äº‹æ¡ˆæ•°</span><span class="stat-value" style="color:#f59e0b;">${totalIncidents}ä»¶</span></div>
        
                <div style="margin:12px 0 8px 0; font-size:11px; color:#06b6d4; font-weight:bold;">
                    <i class="fa-solid fa-heart"></i> å¹³å‡æ„Ÿæƒ…ã‚¹ã‚³ã‚¢
                </div>
                ${Object.entries(avgEmotions).map(([k,v]) => `
                    <div class="stat-item">
                        <span class="stat-label"><div class="emotion-indicator" style="background-color:${getEmotionColorForPopup(k, v)}"></div>${capitalize(k)}</span>
                        <span class="stat-value">${v}</span>
                    </div>
                `).join('')}
        
                <div style="margin:12px 0 8px 0; font-size:11px; color:#06b6d4; font-weight:bold;">
                    <i class="fa-solid fa-signal"></i> å¼·åº¦åˆ¥åˆ†å¸ƒ
                </div>
                ${Object.entries(intensityCount).map(([intensity, count]) => `
                    <div class="stat-item">
                        <span class="stat-label">${intensity}</span>
                        <span class="stat-value">${count}åŒºç”»</span>
                    </div>
                `).join('')}
            `;
        }

        // æ„Ÿæƒ…ãƒ•ã‚£ãƒ«ã‚¿ãƒ¼åˆæœŸåŒ–
        function initializeControls() {
            const filterDiv = document.getElementById('emotion-filters');
            const emotions = [
                { key:'all', label:'å…¨è¡¨ç¤º', icon:'fa-layer-group' },
                { key:'joy', label:'Joy (å–œã³)', icon:'fa-face-smile' },
                { key:'calm', label:'Calm (å¹³é™)', icon:'fa-face-meh' },
                { key:'excitement', label:'Excitement (èˆˆå¥®)', icon:'fa-bolt' },
                { key:'stress', label:'Stress (ã‚¹ãƒˆãƒ¬ã‚¹)', icon:'fa-face-frown' }
            ];
      
            filterDiv.innerHTML = '';
            emotions.forEach(e => {
                const btn = document.createElement('button');
                btn.className = 'emotion-btn' + (selectedEmotion === e.key ? ' active' : '');
                btn.innerHTML = `<i class="fa-solid ${e.icon}"></i> ${e.label}`;
                btn.onclick = () => {
                    selectedEmotion = e.key;
                    document.querySelectorAll('.emotion-btn').forEach(b => b.classList.remove('active'));
                    btn.classList.add('active');
                    loadEmotionData();
                    updateStatistics();
                };
                filterDiv.appendChild(btn);
            });
      
            // è¡¨ç¤ºãƒ¢ãƒ¼ãƒ‰åˆ‡ã‚Šæ›¿ãˆ
            const displayModeSelect = document.getElementById('display-mode');
            if (displayModeSelect) {
                displayModeSelect.onchange = function() {
                    displayMode = this.value;
                    loadEmotionData();
                };
            }
      
            // ãƒ¬ã‚¤ãƒ¤ãƒ¼ON/OFF
            const layerToggle = document.getElementById('layer-toggle');
            if (layerToggle) {
                layerToggle.onclick = function() {
                    showEmotionLayer = !showEmotionLayer;
                    this.classList.toggle('active', showEmotionLayer);
                    this.textContent = showEmotionLayer ? 'ON' : 'OFF';
                    if (showEmotionLayer && emotionLayer) {
                        emotionLayer.addTo(map);
                    } else if (emotionLayer) {
                        map.removeLayer(emotionLayer);
                    }
                };
            }
      
            // ãƒ©ãƒ™ãƒ«ON/OFF
            const labelToggle = document.getElementById('label-toggle');
            if (labelToggle) {
                labelToggle.onclick = function() {
                    showLabels = !showLabels;
                    this.classList.toggle('active', showLabels);
                    this.textContent = showLabels ? 'ON' : 'OFF';
                    loadEmotionData();
                };
            }
      
            // é€æ˜åº¦ã‚¹ãƒ©ã‚¤ãƒ€ãƒ¼
            const opacitySlider = document.getElementById('opacity-slider');
            if (opacitySlider) {
                opacitySlider.oninput = function() {
                    layerOpacity = parseFloat(this.value);
                    // ãƒ‘ãƒ¼ã‚»ãƒ³ãƒˆè¡¨ç¤ºæ›´æ–°
                    const percentageDisplay = document.querySelector('.control-item:nth-child(4) .stat-value');
                    if (percentageDisplay) {
                        percentageDisplay.textContent = Math.round(layerOpacity * 100) + '%';
                    }
                    loadEmotionData();
                };
            }
        }

        // ã‚¿ã‚¤ãƒ ã‚¹ã‚¿ãƒ³ãƒ—æ›´æ–°
        function updateTimestamp() {
            const now = new Date();
            const y = now.getFullYear(), m = now.getMonth()+1, d = now.getDate();
            const h = now.getHours(), min = now.getMinutes(), s = now.getSeconds();
            const timestampElement = document.getElementById('timestamp');
            if (timestampElement) {
                timestampElement.textContent =
                    `${y}å¹´${m}æœˆ${d}æ—¥ ${h.toString().padStart(2,'0')}:${min.toString().padStart(2,'0')}:${s.toString().padStart(2,'0')}`;
            }
        }

        // æ–‡å­—åˆ—å…ˆé ­å¤§æ–‡å­—åŒ–
        function capitalize(str) {
            return str.charAt(0).toUpperCase() + str.slice(1);
        }

        // åˆæœŸåŒ–
        document.addEventListener('DOMContentLoaded', function() {
            console.log('ğŸš€ GitHub Pageså¯¾å¿œç‰ˆ - åˆæœŸåŒ–é–‹å§‹');
      
            try {
                initializeMap();
                initializeControls();
                updateStatistics();
                updateDetailsPanel();
                updateTimestamp();
                setInterval(updateTimestamp, 1000);
                console.log('âœ… GitHub Pageså¯¾å¿œç‰ˆ - åˆæœŸåŒ–å®Œäº†');
            } catch (error) {
                console.error('âŒ åˆæœŸåŒ–ã‚¨ãƒ©ãƒ¼:', error);
            }
        });
    
        // GitHub Pagesç”¨ãƒ‡ãƒãƒƒã‚°é–¢æ•°
        window.debugGitHubPages = () => {
            console.log('=== GitHub Pageså¯¾å¿œç‰ˆãƒ‡ãƒãƒƒã‚°æƒ…å ± ===');
            console.log('ãƒ‡ãƒ¼ã‚¿ã‚½ãƒ¼ã‚¹: åŸ‹ã‚è¾¼ã¿GeoJSON');
            console.log('ãƒ•ã‚£ãƒ¼ãƒãƒ£ãƒ¼æ•°:', sanoAzaGeoJSON ? sanoAzaGeoJSON.features.length : 0);
            console.log('åœ°å›³ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆ:', map ? 'OK' : 'NG');
            console.log('æ„Ÿæƒ…ãƒ¬ã‚¤ãƒ¤ãƒ¼:', emotionLayer ? 'OK' : 'NG');
            console.log('ç¾åœ¨ã®è¨­å®š:', {
                selectedEmotion,
                displayMode,
                showEmotionLayer,
                showLabels,
                layerOpacity
            });
            console.log('=====================================');
        };
    </script>
  
    <!-- ãƒ‡ãƒ¼ã‚¿ã‚½ãƒ¼ã‚¹ã‚¯ãƒ¬ã‚¸ãƒƒãƒˆ -->
    <div style="position: fixed; bottom: 10px; left: 10px; background: rgba(255,255,255,0.9); padding: 8px; border-radius: 4px; font-size: 11px; max-width: 300px; z-index: 1001;">
        <strong>ãƒ‡ãƒ¼ã‚¿ã‚½ãƒ¼ã‚¹:</strong><br>
        å›½åœŸäº¤é€šçœã€Œå›½åœŸæ•°å€¤æƒ…å ±ï¼ˆè¡Œæ”¿åŒºåŸŸãƒ‡ãƒ¼ã‚¿ï¼‰ã€<br>
        æ”¿åºœçµ±è¨ˆã®ç·åˆçª“å£ï¼ˆe-Statï¼‰ã€Œä»¤å’Œ5å¹´å…¨å›½éƒ½é“åºœçœŒå¸‚åŒºç”ºæ‘åˆ¥é¢ç©èª¿ã€<br>
        OpenStreetMap contributors ã«ã‚ˆã‚‹åœ°å›³ã‚¿ã‚¤ãƒ«<br>
        <small style="color: #f59e0b;">â€» GitHub Pageså¯¾å¿œç‰ˆï¼šåŸ‹ã‚è¾¼ã¿ãƒ‡ãƒ¼ã‚¿ã‚’ä½¿ç”¨</small>
    </div>
</body>
</html>
